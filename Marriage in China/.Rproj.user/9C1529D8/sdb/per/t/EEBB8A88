{
    "contents" : "library(dplyr)\nlibrary(ggplot2)\nlibrary(reshape2)\nlibrary(grid)\nlibrary(plotrix)\nlibrary(gridExtra)\nlibrary(Cairo)\n###################################  初婚和年龄 ############################\n\ndat<-read.csv(\"年龄与初婚.csv\",header=T)\ndat.fam<-dat[-c(1, seq(3,51,by=6),57),c(1,seq(6,84,by=3))]\ndat.wom<-dat[-c(1, seq(3,51,by=6),57),c(1,seq(7,85,by=3))]\nnames(dat.wom)<-names(dat.fam)<-c(\"age\",14:40);\ndat.fplot<-melt(dat.fam,id=\"age\");dat.wplot<-melt(dat.wom,id=\"age\");\ndat.fplot$gentle<-rep(\"Male\",1242);dat.wplot$gentle<-rep(\"Female\",1242);\ndat.total<-rbind(dat.fplot,dat.wplot)\n\nCairoPDF(\"age and marriage.pdf\",heigh=8.27,width=12.69,pointsize = 10)\nggplot(dat.total,aes(x=age,y=variable))+geom_tile(aes(fill=value))+\n  scale_fill_continuous(limits=c(174,225893),low = \"white\", high=\"#008B00\",na.value=\"white\")+\n  theme_bw(base_size = 14,base_family=\"serif\")+labs(x =\"Date\", y = \"Cities\") +\n  xlab(\"Age\")+ylab(\"Age at first marriage\")+facet_wrap(~gentle,ncol=2)+\n  scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c(\"15\",\"20\",\"25\",\"30\",\"35\",\">=40\"))+\n  scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c(\"20\",\"25\",\"35\",\"45\",\"55\",\">=65\"))+\n  theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5), \n         legend.title = element_text(face=\"plain\",hjust=2),\n         legend.text.align=0.5,legend.margin=unit(0.1,\"cm\"),\n         axis.ticks.margin=unit(0.1,\"cm\"),axis.ticks.length = unit(0,\"cm\"))+\n  guides(fill=guide_colourbar(title=\"\", barheight=10,barwidth=3))\ndev.off()\n\n###############################  教育和婚姻 #########################\n############################## 总体情况  #############################\n\ndat<-read.csv(\"教育与婚姻.csv\",header=T)\ndat.total<-dat[-c(1,seq(2,56,by=6),63:496),c(1:13)]\ndat.total<-mutate(dat.total,nom=未婚总数/总数15,nomm=未婚男/男15,nomw=未婚女/女15,\n                  po=配偶总数/总数15,pom=配偶男/男15,pow=配偶女/女15,lh=离婚总数/总数15,\n                  lhm=100*离婚男/男15,lhw=1000*离婚女/女15,fwb=未婚男/未婚女)\n\ndat.2<-melt(dat.total[-51,c(1,6:7)]);names(dat.2)<-c(\"age\",\"lb\",\"pop\")\n\np1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+\n  geom_bar(stat=\"identity\",position=\"dodge\",width=0.5)+  \n  theme_bw(base_size =14,base_family=\"serif\")+xlab(\"Age\")+ylab(\"Population not marriaged\")+\n  scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c(\"#8A2BE2\",\"limegreen\"),labels=c(\"Man\",\"Woman\"))+\n  guides(fill=guide_legend(title=\"\", barheight=10,barwidth=3))\n\np2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color=\"#9A32CD\")+\n  theme_bw(base_size=14,base_family=\"serif\")+xlab(\"\")+ylab(\"Ratio\")+\n  scale_x_discrete(breaks=seq(15,65,by=2))+theme(\n    plot.margin = unit(c(3,38,-5,13), \"mm\"))\npp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))\ngrid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))\n\n################################### 本科生 #####################################\ndat.total<-dat[-c(1:373,seq(374,428,by=6),434:496),c(1:13)]\ndat.total<-mutate(dat.total,nom=未婚总数/总数15,nomm=未婚男/男15,nomw=未婚女/女15,\n                  po=配偶总数/总数15,pom=配偶男/男15,pow=配偶女/女15,lh=离婚总数/总数15,\n                  lhm=100*离婚男/男15,lhw=1000*离婚女/女15,fwb=未婚男/未婚女)\n\ndat.2<-melt(dat.total[-51,c(1,6:7)]);names(dat.2)<-c(\"age\",\"lb\",\"pop\")\n\np1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+\n  geom_bar(stat=\"identity\",position=\"dodge\",width=0.5)+  \n  theme_bw(base_size =14,base_family=\"serif\")+xlab(\"Age\")+ylab(\"Population not marriaged\")+\n  scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c(\"#8A2BE2\",\"limegreen\"),labels=c(\"Man\",\"Woman\"))+\n  guides(fill=guide_legend(title=\"\", barheight=10,barwidth=3))\n\np2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color=\"#9A32CD\")+\n  theme_bw(base_size=14,base_family=\"serif\")+xlab(\"\")+ylab(\"Ratio\")+\n  scale_x_discrete(breaks=seq(15,65,by=2))+theme(\n    plot.margin = unit(c(3,38,-5,10), \"mm\"))\npp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))\ngrid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))\n\n\n\n################################### 研究生 #####################################\ndat.total<-dat[-c(1:435,seq(436,490,by=6),496),c(1:13)]\ndat.total<-mutate(dat.total,nom=未婚总数/总数15,nomm=未婚男/男15,nomw=未婚女/女15,\n                  po=配偶总数/总数15,pom=配偶男/男15,pow=配偶女/女15,lh=离婚总数/总数15,\n                  lhm=100*离婚男/男15,lhw=1000*离婚女/女15,fwb=未婚男/未婚女)\n\ndat.2<-melt(dat.total[-51,c(1,6:7)]);names(dat.2)<-c(\"age\",\"lb\",\"pop\")\n\np1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+\n  geom_bar(stat=\"identity\",position=\"dodge\",width=0.5)+  \n  theme_bw(base_size =14,base_family=\"serif\")+xlab(\"Age\")+ylab(\"Population not marriaged\")+\n  scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c(\"#8A2BE2\",\"limegreen\"),labels=c(\"Man\",\"Woman\"))+\n  guides(fill=guide_legend(title=\"\", barheight=10,barwidth=3))\n\np2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color=\"#9A32CD\")+\n  theme_bw(base_size=14,base_family=\"serif\")+xlab(\"\")+ylab(\"Ratio\")+\n  scale_x_discrete(breaks=seq(15,65,by=2))+theme(\n    plot.margin = unit(c(3,38,-5,10), \"mm\"))\npp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))\ngrid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))\n\n\n\n#########################  region and marriage ###############################\ndat<-read.csv(\"地区和婚姻.csv\",header=T)\ndat.total<-dat[-1,c(1:13)]\ndat.total<-mutate(dat.total,nom=notmtotal/total15,nomm=notmman/total15man,nomw=notmwom/total15fe,\n                  po=poutotal/total15,pom=pouman/total15man,pow=pouwom/total15fe,lh=lihtotal/total15,\n                  lhm=1000*lihunnan/total15man,lhw=1000*lihunwom/total15fe,fwb=notmman/notmwom)\n\npyramid.plot(dat.total$nomm,dat.total$nomw,labels=dat.total$region)\n\n\ndat.2<-melt(dat.total[,c(1,6:7)]);names(dat.2)<-c(\"region\",\"lb\",\"pop\")\n\nCairoPDF(\"char_3.7_2.pdf\",heigh=8.27,width=12.69,pointsize = 10)\np1<-ggplot(dat.2,aes(region,pop,group=lb,fill=lb))+\n  geom_bar(stat=\"identity\",position=\"dodge\",width=0.5)+  \n  theme_bw(base_size =12,base_family=\"serif\")+xlab(\"\")+ylab(\"Population not marriaged\")+\n  scale_fill_manual(values=c(\"#8A2BE2\",\"limegreen\"),labels=c(\"Man\",\"Woman\"))+\n  guides(fill=guide_legend(title=\"\", barheight=10,barwidth=3))\n\np2<-ggplot(dat.total[,c(1,23)],aes(x=region,y=fwb))+geom_point(color=\"#9A32CD\")+\n  theme_bw(base_size=13,base_family=\"serif\")+xlab(\"\")+ylab(\"Ratio\")+theme(\n    plot.margin = unit(c(5,28,-5,6), \"mm\"))\npp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))\ngrid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))\ndev.off()\n\n################################## 初婚和初婚年龄 ###############################\n\ndat<-read.csv(\"初婚和初婚年份.csv\",header=T)\ndat.man<-dat[-c(1,seq(3,45,by=3),46),c(1,seq(6,97,by=3))]\ndat.wom<-dat[-c(1,seq(3,45,by=3),46),c(1,seq(7,97,by=3))]\nnames(dat.man)<-names(dat.wom)<-c(\"age\",1980:2010)\ndat.mplot<-melt(dat.man,id=\"age\");dat.wplot<-melt(dat.wom,id=\"age\")\ndat.mplot$gentle<-rep(\"Male\",899);dat.wplot$gentle<-rep(\"Female\",899);\ndat.total<-rbind(dat.mplot,dat.wplot)\n\nman.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(6,97,by=3))]),gentle=rep(\"Male\",31))\nwom.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(7,97,by=3))]),gentle=rep(\"Female\",31))\nmean.total<-rbind(wom.me,man.me)\n\nCairoPDF(\"age and year.pdf\",heigh=8.27,width=12.69,pointsize = 10)\np1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+\n  scale_fill_continuous(limits=c(0,208292),low = \"white\", high=\"#008B00\",na.value=\"white\")+\n  theme_bw(base_size = 14,base_family=\"serif\")+labs(x =\"Date\", y = \"Cities\") +\n  xlab(\"Age\")+ylab(\"Age at first marriage\")+facet_wrap(~gentle, ncol = 2)+\n  scale_x_discrete(breaks=seq(1980,2010,by=3))+\n  scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c(\"20\",\"25\",\"35\",\"45\",\"55\",\">=65\"))+\n  theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5), \n         legend.title = element_text(face=\"plain\",hjust=2),\n         legend.text.align=0.5,legend.margin=unit(0.1,\"cm\"),\n         axis.ticks.margin=unit(0.1,\"cm\"),axis.ticks.length = unit(0,\"cm\"))+\n  guides(fill=guide_colourbar(title=\"\", barheight=10,barwidth=3))\n\np2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color=\"#9A32CD\")+\n  theme_bw(base_size = 13,base_family=\"serif\")+xlab(\"\")+ylab(\"Mean age at first marriage\")+\n  scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+\n  theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5), \n         plot.margin = unit(c(5,40,-5,4), \"mm\"),\n         legend.title = element_text(face=\"plain\",hjust=2),\n         legend.text.align=0.5,legend.margin=unit(0.1,\"cm\"),\n         axis.ticks.margin=unit(0.1,\"cm\"),axis.ticks.length = unit(0,\"cm\"))\n  \npp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))\ngrid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))\ndev.off()\n",
    "created" : 1415506917977.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2990466234",
    "id" : "EEBB8A88",
    "lastKnownWriteTime" : 1415711324,
    "path" : "F:/娱乐项目/中国婚姻/Marriage.R",
    "project_path" : "Marriage.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}