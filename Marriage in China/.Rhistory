theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.mplot,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=2,heights=c(4/8,4/8))
p1<-ggplot(dat.wplot,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.mplot,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=2,heights=c(4/8,4/8))
fix(dat.mplot)
dim(dat.mplot)
dim(dat.wplot)
dat.mplot$gentle<-rep("Male",899);dat.wplot$gentle<-rep("Female",899);
dat.total<-rbind(dat.mplot,dat.wplot)
fix(dat.total)
ggplot(dat.wplot,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
?facet_wrap
ggplot(dat.wplot,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 1)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 1)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
library(dplyr)
library(ggplot2)
library(reshape2)
library(grid)
library(plotrix)
library(gridExtra)
dat<-read.csv("年龄与初婚.csv",header=T)
dat.fam<-dat[-c(1, seq(3,51,by=6)),c(1,seq(6,84,by=3))]
dat.wom<-dat[-c(1, seq(3,51,by=6)),c(1,seq(7,85,by=3))]
names(dat.wom)<-names(dat.fam)<-c("age",14:40);
dat.fplot<-melt(dat.fam,id="age");dat.wplot<-melt(dat.wom,id="age");
ggplot(dat.wplot,aes(x=age,y=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(174,225893),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+
scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c("15","20","25","30","35",">=40"))+
scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
dat.fam
dim(dat.fam)
dat
dat.fam<-dat[-c(1, seq(3,51,by=6),57),c(1,seq(6,84,by=3))]
dat.fam
dim(dat)
dat.fam
dat.wom<-dat[-c(1, seq(3,51,by=6),57),c(1,seq(7,85,by=3))]
names(dat.wom)<-names(dat.fam)<-c("age",14:40);
dim(dat.fam)
dat.fam$gentle<-rep("Male",46);dat.wom$gentle<-rep("Female",46);
dat.fam<-dat[-c(1, seq(3,51,by=6),57),c(1,seq(6,84,by=3))]
dat.wom<-dat[-c(1, seq(3,51,by=6),57),c(1,seq(7,85,by=3))]
names(dat.wom)<-names(dat.fam)<-c("age",14:40);
dat.fplot<-melt(dat.fam,id="age");dat.wplot<-melt(dat.wom,id="age");
dim(dat.fplot)
dat.fplot$gentle<-rep("Male",1242);dat.wplot$gentle<-rep("Female",1242);
dat.total<-rbind(dat.fplot,dat.wplot)
fix(dat.total)
ggplot(dat.wplot,aes(x=age,y=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(174,225893),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle,ncol=2)+
scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c("15","20","25","30","35",">=40"))+
scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
ggplot(dat.total,aes(x=age,y=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(174,225893),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle,ncol=2)+
scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c("15","20","25","30","35",">=40"))+
scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
CairoPDF("age and marriage.pdf",heigh=8.27,width=12.69,pointsize = 10)
ggplot(dat.total,aes(x=age,y=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(174,225893),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle,ncol=2)+
scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c("15","20","25","30","35",">=40"))+
scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
dev.off()
CairoPDF("age and marriage.pdf",heigh=8.27,width=12.69,pointsize = 10)
ggplot(dat.total,aes(x=age,y=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(174,225893),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle,ncol=2)+
scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c("15","20","25","30","35",">=40"))+
scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
dev.off()
library(Cairo)
CairoPDF("age and marriage.pdf",heigh=8.27,width=12.69,pointsize = 10)
ggplot(dat.total,aes(x=age,y=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(174,225893),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle,ncol=2)+
scale_y_discrete(breaks=c(15,20,25,30,35,40), labels=c("15","20","25","30","35",">=40"))+
scale_x_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
dev.off()
dat<-read.csv("初婚和初婚年份.csv",header=T)
dat.man<-dat[-c(1,seq(3,45,by=3),46),c(1,seq(6,97,by=3))]
dat.wom<-dat[-c(1,seq(3,45,by=3),46),c(1,seq(7,97,by=3))]
names(dat.man)<-names(dat.wom)<-c("age",1980:2010)
dat.mplot<-melt(dat.man,id="age");dat.wplot<-melt(dat.wom,id="age")
dat.mplot$gentle<-rep("Male",899);dat.wplot$gentle<-rep("Female",899);
dat.total<-rbind(dat.mplot,dat.wplot)
CairoPDF("age and year.pdf",heigh=8.27,width=12.69,pointsize = 10)
p1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.mplot,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=2,heights=c(4/8,4/8))
dev.off()
ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
fix(dat)
dat.mean<-data.frame(male=dat[46,c(1,seq(6,97,by=3))],female=dat[46,c(1,seq(7,97,by=3))])
dat.man
dat[46,c(1,seq(6,97,by=3))]
dat[46,c(1,seq(7,97,by=3))]
dat.mean<-data.frame(male=dat[46,c(seq(6,97,by=3))],female=dat[46,c(seq(7,97,by=3))])
dat.mean
as.numeric(dat[46,c(seq(6,97,by=3))]);
rbind(as.numeric(dat[46,c(seq(6,97,by=3))]),as.numeric(dat[46,c(seq(7,97,by=3))]);
wom.me<-as.numeric(dat[46,c(seq(7,97,by=3))]);
man.me<-as.numeric(dat[46,c(seq(6,97,by=3))]);
rbind(wan.me,wom.me)
wom.me<-as.numeric(dat[46,c(seq(7,97,by=3))]);
rbind(wan.me,wom.me)
wom.me
man.me[,1]<-as.numeric(dat[46,c(seq(6,97,by=3))])
plot(wom.me)
plot(man.me)
man.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(6,97,by=3))]);
man.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(6,97,by=3))]))
wom.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(7,97,by=3))]))
mean.total<-rbind(man.me,wom.me)
mean.total
man.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(6,97,by=3))]),gentle=rep("Male",31))
wom.me<-data.frame(year=1980:2010,age=as.numeric(dat[46,c(seq(7,97,by=3))]),gentle=rep("Female",31))
mean.total<-rbind(man.me,wom.me)
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
str(mean.plot)
str(mean.total)
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_discrete(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)
-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
p1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=2,heights=c(4/8,4/8))
grid.arrange(pp2,pp1,ncol=1,heights=c(4/8,4/8))
p2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
plot.margin = unit(c(5,28,-5,6), "mm"),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
CairoPDF("age and year.pdf",heigh=8.27,width=12.69,pointsize = 10)
p1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 14,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
plot.margin = unit(c(5,28,-5,6), "mm"),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
dev.off()
CairoPDF("age and year.pdf",heigh=8.27,width=12.69,pointsize = 10)
p1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 13,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
plot.margin = unit(c(5,35,-5,6), "mm"),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
dev.off()
CairoPDF("age and year.pdf",heigh=8.27,width=12.69,pointsize = 10)
p1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 13,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
plot.margin = unit(c(5,40,-5,4), "mm"),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
dev.off()
mean.total<-rbind(wom.me,man.me)
CairoPDF("age and year.pdf",heigh=8.27,width=12.69,pointsize = 10)
p1<-ggplot(dat.total,aes(y=age,x=variable))+geom_tile(aes(fill=value))+
scale_fill_continuous(limits=c(0,208292),low = "white", high="#008B00",na.value="white")+
theme_bw(base_size = 14,base_family="serif")+labs(x ="Date", y = "Cities") +
xlab("Age")+ylab("Age at first marriage")+facet_wrap(~gentle, ncol = 2)+
scale_x_discrete(breaks=seq(1980,2010,by=3))+
scale_y_discrete(breaks=c(20,25,35,45,55,65), labels=c("20","25","35","45","55",">=65"))+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))+
guides(fill=guide_colourbar(title="", barheight=10,barwidth=3))
p2<-ggplot(mean.total,aes(y=age,x=year))+geom_point(color="#9A32CD")+
theme_bw(base_size = 13,base_family="serif")+xlab("")+ylab("Mean age at first marriage")+
scale_x_continuous(breaks=seq(1980,2010,by=3))+facet_wrap(~gentle,ncol=2)+
theme( axis.ticks = element_blank(),axis.text.x = element_text(angle =0, hjust = 0.5),
plot.margin = unit(c(5,40,-5,4), "mm"),
legend.title = element_text(face="plain",hjust=2),
legend.text.align=0.5,legend.margin=unit(0.1,"cm"),
axis.ticks.margin=unit(0.1,"cm"),axis.ticks.length = unit(0,"cm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
dev.off()
dat<-read.csv("教育与婚姻.csv",header=T)
dat.total<-dat[-c(1,seq(2,56,by=6),63:496),c(1:13)]
dat.total<-mutate(dat.total,nom=未婚总数/总数15,nomm=未婚男/男15,nomw=未婚女/女15,
po=配偶总数/总数15,pom=配偶男/男15,pow=配偶女/女15,lh=离婚总数/总数15,
lhm=100*离婚男/男15,lhw=1000*离婚女/女15,fwb=未婚男/未婚女)
pyramid.plot(dat.total$nomm,dat.total$nomw,labels=c(15:65))
pyramid.plot(dat.total$pow,dat.total$pom, labels=c(15:65))
pyramid.plot(dat.total$lhw,dat.total$lhm, labels=c(15:65))
pyramid.plot(dat.total$pom,dat.total$lhm, labels=c(15:65))
dat.2<-melt(dat.total[-51,c(1,6:7)]);names(dat.2)<-c("age","lb","pop")
p1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+
geom_bar(stat="identity",position="dodge",width=0.5)+
theme_bw(base_size =14,base_family="serif")+xlab("Age")+ylab("Population not marriaged")+
scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c("#8A2BE2","limegreen"),labels=c("Man","Woman"))+
guides(fill=guide_legend(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color="#9A32CD")+
theme_bw(base_size=14,base_family="serif")+xlab("")+ylab("Ratio")+
scale_x_discrete(breaks=seq(15,65,by=2))+theme(
plot.margin = unit(c(3,38,-5,13), "mm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
seq(436,490,by=6)
dat.total<-dat[-c(1：435,seq(436,490,by=6),496),c(1:13)]
dat.total<-dat[-c(1:435,seq(436,490,by=6),496),c(1:13)]
dat.total<-mutate(dat.total,nom=未婚总数/总数15,nomm=未婚男/男15,nomw=未婚女/女15,
po=配偶总数/总数15,pom=配偶男/男15,pow=配偶女/女15,lh=离婚总数/总数15,
lhm=100*离婚男/男15,lhw=1000*离婚女/女15,fwb=未婚男/未婚女)
dat.2<-melt(dat.total[-51,c(1,6:7)]);names(dat.2)<-c("age","lb","pop")
p1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+
geom_bar(stat="identity",position="dodge",width=0.5)+
theme_bw(base_size =14,base_family="serif")+xlab("Age")+ylab("Population not marriaged")+
scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c("#8A2BE2","limegreen"),labels=c("Man","Woman"))+
guides(fill=guide_legend(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color="#9A32CD")+
theme_bw(base_size=14,base_family="serif")+xlab("")+ylab("Ratio")+
scale_x_discrete(breaks=seq(15,65,by=2))+theme(
plot.margin = unit(c(3,38,-5,13), "mm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
dat.total
p1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+
geom_bar(stat="identity",position="dodge",width=0.5)+
theme_bw(base_size =14,base_family="serif")+xlab("Age")+ylab("Population not marriaged")+
scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c("#8A2BE2","limegreen"),labels=c("Man","Woman"))+
guides(fill=guide_legend(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color="#9A32CD")+
theme_bw(base_size=14,base_family="serif")+xlab("")+ylab("Ratio")+
scale_x_discrete(breaks=seq(15,65,by=2))+theme(
plot.margin = unit(c(3,41,-5,10), "mm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
p1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+
geom_bar(stat="identity",position="dodge",width=0.5)+
theme_bw(base_size =14,base_family="serif")+xlab("Age")+ylab("Population not marriaged")+
scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c("#8A2BE2","limegreen"),labels=c("Man","Woman"))+
guides(fill=guide_legend(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color="#9A32CD")+
theme_bw(base_size=14,base_family="serif")+xlab("")+ylab("Ratio")+
scale_x_discrete(breaks=seq(15,65,by=2))+theme(
plot.margin = unit(c(3,38,-5,10), "mm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
dat.total<-dat[-c(1:373,seq(374,428,by=6),434:496),c(1:13)]
dat.total<-mutate(dat.total,nom=未婚总数/总数15,nomm=未婚男/男15,nomw=未婚女/女15,
po=配偶总数/总数15,pom=配偶男/男15,pow=配偶女/女15,lh=离婚总数/总数15,
lhm=100*离婚男/男15,lhw=1000*离婚女/女15,fwb=未婚男/未婚女)
dat.2<-melt(dat.total[-51,c(1,6:7)]);names(dat.2)<-c("age","lb","pop")
p1<-ggplot(dat.2,aes(age,pop,group=lb,fill=lb))+
geom_bar(stat="identity",position="dodge",width=0.5)+
theme_bw(base_size =14,base_family="serif")+xlab("Age")+ylab("Population not marriaged")+
scale_x_discrete(breaks=seq(15,65,by=2))+scale_fill_manual(values=c("#8A2BE2","limegreen"),labels=c("Man","Woman"))+
guides(fill=guide_legend(title="", barheight=10,barwidth=3))
p2<-ggplot(dat.total[-51,c(1,23)],aes(x=教育程度,y=fwb))+geom_point(color="#9A32CD")+
theme_bw(base_size=14,base_family="serif")+xlab("")+ylab("Ratio")+
scale_x_discrete(breaks=seq(15,65,by=2))+theme(
plot.margin = unit(c(3,38,-5,10), "mm"))
pp1 <- ggplot_gtable(ggplot_build(p1));pp2 <- ggplot_gtable(ggplot_build(p2))
grid.arrange(pp2,pp1,ncol=1,heights=c(3/8,5/8))
