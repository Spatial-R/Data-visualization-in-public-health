<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    
    <script src='http://timelyportfolio.github.io/rCharts_errorbar/js/d3.v3.js' type='text/javascript'></script>
    <script src='http://timelyportfolio.github.io/rCharts_errorbar/js/errorbar.js' type='text/javascript'></script>
    <script src='http://timelyportfolio.github.io/rCharts_errorbar/js/d3-grid.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 1000px;
      height: 500px;
    }  
    </style>
    
  </head>
  <body>
    
    <style>
.axis line, .axis path {
  fill: none;
  shape-rendering: crispEdges;
  stroke: lightgrey;
}
.axis text {
  fill: grey;
  font-family: "Source Sans Pro", sans-serif;
  font-size: 10px;
}
</style>

      <script>
       debugger;
      (function(){
        var opts = {
 "data": {
 "id": [ "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "218", "219", "220", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "270", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303", "304", "305", "306", "307", "308", "309", "310", "311", "312", "313", "314", "315", "316", "317", "318", "319", "320", "321", "322", "323", "324", "325", "326", "327", "328", "329", "330", "331", "332", "333", "334", "335", "336", "337", "338", "339", "340", "341", "342", "343", "344", "345", "346", "347", "348", "349", "350", "351", "352", "353", "354", "355", "356", "357", "358", "359", "360", "361", "362", "363", "364", "365", "366", "367", "368", "369", "370", "371", "372", "373", "374", "375", "376", "377", "378", "379", "380", "381", "382", "383", "384", "385", "386", "387", "388", "389", "390", "391", "392", "393", "394", "395", "396", "397", "398", "399", "400", "401", "402", "403", "404", "405", "406", "407" ],
"intercept": [ -2.959, 1.6272, 2.0586, 0.56843, -2.014, -1.0761, -1.0847, -2.6054, -1.7508, 0.76047, 0.36014, -0.86362, 0.030642, 1.0643, -0.34903, 1.9627, 0.34586, 1.5564, 3.4903, -0.31166, -1.3492, 1.7221, 0.2096, -0.8429, 0.02531, -1.7849, 0.98082, 2.0122, -1.9434, -1.7731, -0.81989, -2.3053, 1.3654, -0.96959, 0.46302, -2.1526, -0.51187, 3.8045, -1.9848, -0.84509, -0.79944, 0.72499,  1.378, -0.35372, -1.5933, 0.12029, -1.6499, -0.14811, 1.1434, -1.9765, 1.2077, -1.4846, -1.4912, 1.0536, 3.1479, -1.4246, 1.6107, 1.5281, -0.41062, 2.6654, 0.93644, -0.76822, -2.053, 4.3614, -1.6834, -2.1885, -0.5219, 0.32863, -2.4314, -0.042963, -1.6745,  1.005, 1.8097, -2.3989, 0.8888, 0.55646, 1.7854, -1.7208, 1.2328, -1.9359, -0.63288, -2.4169, 0.11313, 1.1116, -0.43828, 1.5311, -2.2041, -2.0428, -1.8354, 2.2486, -0.12758, 1.3835, 1.2744, 2.1061, 0.50213, -2.0684, 0.051321,  2.283,  1.647, 0.68395, 1.1406, 0.21243, 0.78115, -0.095092, -1.3424, -0.69086, 0.23326, -0.13938, -1.4305, 3.2149, 1.8331, 0.53123, 1.2413, -0.73725, -2.8669, -2.1617, 2.8901, -0.30293, 1.7212, 1.3425, 0.79545, -2.2169, -1.2985, 1.9762, 1.5225, -0.37936, 1.9598, 0.97517, -1.7238, -1.6146, 2.7953, -0.44542, -1.3129, 3.1073, 3.8748, -0.97747, -1.7093, -0.077322, -1.2078, -1.1604, 0.90144, -1.9026, -0.8538, -0.69871, 0.97879, -1.7095, -0.28543, 1.1424, -0.15223, 1.9195, -0.96848, -0.0018799,  1.161, -1.8168, 0.17964, -0.94899,  2.233, -0.91393, -2.1264, -0.26834, -1.0758, 2.0851, -2.1716, 2.3473, 1.7044, -2.1498, -0.16123, -0.28053, 0.89051, -0.79869, 0.97834, 0.34804, 2.4573, 1.4641, 1.8755, -0.68976,  2.539, 2.2149,  2.517, -0.87665, 1.8316, 2.4338, -1.397, 1.5125, -1.5918, -1.9683, 1.7975, -0.83969, -1.9226, -2.6957, -2.3705, 3.3814, 2.7612, 2.2709, 0.99834, -0.81436, 0.75586, 0.04764, 1.3264, -1.2725, 1.8946, 0.82014, -1.7911, -1.5263, 0.85716, -2.3616, -0.54491, -2.4068, -0.20574, -1.9585, -0.56379,  4.272, 1.3266, 0.88713, -2.1949, -0.27088, 0.88754, -0.30917, -1.008, -2.3566, -0.74388, 0.57873, 1.3588, -0.33539, -1.7553, 0.63755, -0.37816, 0.26368, -0.26237, 2.5385, -1.119, 1.0821, -2.4741, -0.93075, -0.50324, -0.80511, -1.5366, 1.2521, -0.50672, -1.6508, -1.8092, 0.86736,   1.04, 1.4658, -0.45565, 2.2445, 0.25498, 2.2844, 0.31475, 0.82817, 0.90126, 0.78471, -0.35196, 1.2387, -0.76152, -0.051115, -0.91417, 0.90694, -1.3639, -0.40292, -2.5138, 0.075165, 3.3914, -0.95219, -2.0687, -0.39163, -1.2124, -0.067889, -0.32127, 0.13798, -0.36114, -1.067, -2.4535, 1.2602, -0.54745, 1.0604, 1.3982, 2.1654, 1.6325, -0.5592, 0.32877, 0.08875, -1.5312, 5.2421, -0.51979, 0.11244, -1.758, -2.2662, 3.7429, 0.096918, 2.7497, -1.8966, 2.2997, -0.25472, -2.0507, -0.58765, -1.842, 3.4278, -2.3778, -1.1489, -0.86285, 0.77855, 0.2944, 4.0582, 2.2593, -0.35264, 2.5176, 0.91386, 0.022415, -1.8575, -0.014522, -0.44059, -1.7658, 2.1308, 0.34556, 0.52847, 1.9664,  2.955, 0.48834, -0.0046208, 0.6773, -2.2754, -1.2244, 1.5425, 0.69685, -1.351, -0.74179, -2.5001, 1.8165, -0.67094, -2.5686, -0.85656, -0.6025, 0.7625, 3.4336, 1.5401, -2.0059, -1.5361, -1.3399, 0.76918, 0.046107, 0.61735, 2.5018, 0.27919, 2.0259, -0.82703, -0.46119, -0.85263, -0.77858, -1.8471, 2.5972, -2.0239, -0.59785, -0.14173, 0.62422, -1.2813, -1.7654, 1.5578, 0.84618, 0.00063981, 0.043031, 1.6722, -2.2512, -2.1147, 1.3122, 1.4927, 0.69583, -0.34131, -2.5899, 2.1444, 0.34272, -0.48897, 2.5626, -0.70039, -2.7604, 2.3021, -0.058375, 0.54118, -0.084526, -2.0059, 0.88315, 2.5489, 0.49071, 1.5416, -0.9728, -0.26852, -0.77991, 4.6104, 1.8287, -0.22119, 1.1143, 0.36656, 2.6113, -1.0642, 0.32768, 0.2301, -1.0114, -2.1958, -2.362, -0.10206, -2.6537, 0.7893, 2.2417, 1.3571, -0.87002, -1.0872, 2.4766 ],
"se": [ 1.0934, 0.29964, 0.84755, 0.32891, 1.3834, 0.79129, 0.7987, 1.1806, 1.4945, 0.39469, 0.33221, 2.2397, 0.40655, 0.31654, 0.41991, 0.39402, 0.30365, 0.37809,  1.058, 1.2113, 1.7856, 0.4463, 0.49659, 0.57146, 0.51614,  1.466, 0.45458, 0.39803,   1.43, 1.4756, 0.87707, 1.2756, 0.28044, 2.0673, 0.29414, 1.3289, 0.38672, 0.43697, 1.3918,  0.468, 0.38117, 0.27129, 0.41077, 0.44848, 0.51843, 0.62166, 0.73167, 0.44005, 0.50905, 0.45044, 0.61397, 0.55587,  1.684, 0.71957, 0.9181, 1.7009, 1.0939, 0.30862, 0.3272, 0.30005, 0.28312, 0.82801, 1.3744, 0.85508, 0.72539, 1.3017, 0.8707, 0.65735, 1.2144, 0.47587, 1.5485, 0.67081, 0.36085, 1.2232, 0.32569, 0.2524, 0.28092, 1.5081, 0.37948, 1.4435, 2.4896, 1.2219, 1.0618, 0.37744, 0.40302, 0.24674,  1.304, 1.3707, 1.4983, 0.31104, 0.43783, 0.37757, 0.56017, 0.69388, 0.30949, 0.70802, 1.0828, 1.4273, 0.29865, 0.2854, 0.30391, 0.34244, 0.3295, 0.28967, 0.77295, 0.36718, 0.3072, 0.48607, 0.83646, 0.40898, 0.38516, 0.73258, 0.32331,  1.038, 1.1148, 0.71727, 0.46784, 0.53269, 0.39727, 0.38036, 0.63836, 1.3069, 1.8724, 0.50187, 0.5581, 0.92184, 0.29192, 0.40542, 0.7419, 0.39762, 0.46136,  1.081, 0.80418, 0.39572, 0.97937, 0.80938, 0.73785, 0.31636, 0.79877, 0.80209, 0.27455, 1.4166, 0.55994, 0.33691, 0.28169,  1.528, 0.93756, 0.27428, 0.6037, 0.28835, 2.0385, 0.34829, 0.29349, 0.52533, 0.40108, 0.56053, 0.3799, 2.1239,  1.324, 0.64843, 0.79428, 0.72507, 1.3014, 0.5647, 0.29297, 1.3416, 0.67804, 0.33636, 0.47184, 0.88691, 0.31763, 0.33041, 0.78457, 0.50492, 0.34139, 0.34962, 1.2926, 0.3109, 0.33509, 0.30973, 0.58664, 0.41331, 0.38441, 0.27137, 0.77337, 1.4243, 0.63996, 0.5179, 1.4121, 1.1405, 1.2515, 0.74748, 1.4198, 0.40556, 0.27113, 0.50195, 0.68051, 0.62811, 0.31208, 0.7887, 0.29781, 0.32202, 1.4675, 0.75845, 0.36321, 1.2724, 0.57556, 1.2221, 1.0044, 1.4026, 0.89144, 0.52107, 0.68912, 0.52169, 1.2922, 0.33145, 0.26871, 0.61744, 0.8016, 1.2591, 2.2997, 0.71293,  0.356, 0.51298, 1.4812, 0.44081, 0.91445, 0.67251, 0.36283, 0.32017, 1.9091, 0.9418, 1.2096, 0.80399, 0.91455, 2.2236, 1.6605, 0.48158, 0.95206, 1.5571, 1.5152, 0.48605, 0.53273, 0.34844, 0.27268, 1.4351, 0.32913, 0.34489, 0.38787, 1.2506, 0.78239, 0.42398, 0.68594, 0.68521, 0.87238, 1.0125, 0.95758, 0.30876, 1.7284, 0.61405,  1.214, 1.1057, 0.90235, 2.1266, 0.51042, 0.4643, 1.8754, 0.49071, 0.59292, 0.51289, 0.39194, 1.9569, 1.2166, 0.96543, 0.59795, 0.68118, 0.53644, 0.33721, 0.36191, 0.91714, 0.3602, 1.0878, 0.79237, 0.78132, 0.37091, 0.31672, 1.5161, 1.2982, 0.38938, 0.37281, 0.34735, 0.71686, 0.31178, 0.67321, 0.44397, 0.2924, 0.75869, 0.45314, 0.38207, 1.9959, 0.59578, 0.39357, 0.78526, 0.9114, 0.27503, 0.28331,  0.668, 0.38734, 0.4215, 0.74002, 0.5142, 0.41536, 1.5247, 0.43544, 0.37359, 0.39206, 0.96111, 0.34198, 0.39342, 0.30892, 0.46291, 1.2738, 1.8674, 0.28645, 0.36188, 1.7682, 0.85528, 1.1982, 0.54093, 0.84003,  1.179, 2.1707, 0.39866, 0.28698, 0.40045, 0.38337, 1.3804, 1.5904, 1.7373, 0.52687, 0.42447, 0.67234, 0.37966, 0.74359, 0.38188, 0.83385, 0.59943, 0.8188, 0.56368, 1.4806, 0.75389, 1.3693, 0.4035, 1.0432, 0.27596, 1.7993, 1.5391, 0.29411, 0.36208, 1.0057, 0.44631, 0.3231, 1.3017, 1.3484, 0.63225, 0.31726, 0.60388, 0.36042, 1.1727, 0.28998, 0.31204, 0.60375, 0.3487, 2.3848, 1.1326, 0.26261, 0.46655,  0.327, 0.32708, 0.71375, 0.38679, 0.42135, 0.42497, 0.31986, 0.46625, 0.40848, 0.48264, 0.85531, 0.72897, 0.42546, 0.38309, 0.82049, 0.32849, 0.39186, 0.28521, 0.2924, 2.0294, 1.3163,   1.25, 1.0307, 1.1554, 0.31324, 1.3994, 0.38076, 0.54971, 1.9873, 0.53761 ] 
},
"height":    500,
"width":   1000,
"margin": {
 "top":     10,
"bottom":     10,
"right":     50,
"left":    100 
},
"x": "id",
"y": "intercept",
"radius":      4,
"sort": {
 "var": "intercept" 
},
"whiskers": function(d){return [d.intercept - 1.96 * d.se, d.intercept + 1.96 * d.se]},
"tooltipLabels": [ "id", "intercept", "se" ] 
};

        var color = d3.scale.category20();

        var svg = d3.select("body").append("svg")
            .attr("width", opts.width)
            .attr("height", opts.height)

          if(!(opts.margin)) opts.margin = { top: 10, right: 50, bottom: 20, left: 50 }

          //data transform since rCharts does not use toJSONArray() by default
          var data = [];

          opts.data[d3.keys(opts.data)[0]].forEach(function(d,i){
            var tempobj = {};
            d3.keys(opts.data).forEach(function(key){
              tempobj[key] = opts.data[key][i];
            });
            data.push(tempobj);
          });

          //if no facet then just make blank object
          if(!(opts.facet)) opts.facet = {};
          //if facet not provided for x or y make Dummy variable
          opts.facet.x = opts.facet.x ? opts.facet.x : "Dummy"
          opts.facet.y = opts.facet.y ? opts.facet.y : "Dummy"    
          if(opts.facet.x === "Dummy" || opts.facet.y === "Dummy") {
            data.forEach(function(d){
              d.Dummy = 1;
            })
          }
          var rows = d3.set(data.map(function(d){return d[opts.facet.y]})).values();
          var nrow = rows.length;
          var cols = d3.set(data.map(function(d){return d[opts.facet.x]})).values()
          var ncol = cols.length;
  
          var tuples = d3.merge(
            rows.map(function(row,irow){
              return cols.map(function(col,icol){
                return {key:row + "~" + col, values: {"row":irow, "col":icol} }
              })
            })
          );
    
          var grid = d3.layout.grid()
            .rows( nrow )
            .cols( ncol )
            .size([ opts.width, opts.height-100])
            .bands();

          var svgGrid = d3.select("#" + opts.id).append("svg")
            .attr("width", opts.width)
            .attr("height", opts.height);
          
          grid(tuples);  //apply d3-grid layout

          tuples.forEach(function(cell,cellnum) {
            // Filter the data set for the x and y facets
            var filteredData = data.filter(function(d){
              return d[opts.facet.x] == cell.key.split('~')[1]
            });
            //split for now but could easily do all in one filter
            filteredData = filteredData.filter(function(d){
              return d[opts.facet.y] == cell.key.split('~')[0]
            });
    
            filteredData = d3.nest()
              .key(function(d){ return d[opts.facet.x] + "~" + opts.facet.y} ).sortKeys(d3.ascending)
              //.key(function(d){ return d[opts.group] } )
              .entries(filteredData);

            var errorbar = d3.svg.errorbar()
              .height(grid.nodeSize()[1]- opts.margin.top - opts.margin.bottom )
              .width(grid.nodeSize()[0] - opts.margin.right - opts.margin.left)
              .xVar(opts.x)
              .yVar(opts.y)
              .colorVar(opts.color)
              .color(color)
              .radius(opts.radius)
              .tooltipLabels(opts.tooltipLabels?opts.tooltipLabels:[]);

            if(opts.whiskers) {
              if (typeof opts.whiskers === "function") {
                errorbar.whiskers(opts.whiskers)
              } else {
                errorbar.whiskers(
                  function(d) {
                    return [d[opts.whiskers[0]], d[opts.whiskers[1]]]
                  }
                );
              }
            }; 

            if(opts.sort) {
              errorbar.sort(opts.sort);
            }

            var g = svg //.selectAll("g").data(filteredData);
              .append("g").data(filteredData) //g.enter().append("g")
                .attr("transform","translate(" + (+cell.x + opts.margin.right) + "," + (+cell.y+opts.margin.top) + ")")
                .call(errorbar);

          });
      })();
      </script>
    
  </body>
</html>
