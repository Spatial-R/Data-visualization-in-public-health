<!doctype HTML>
<meta charset = 'utf-8'>
<html>
  <head>
    
    <script src='js/d3.v3.js' type='text/javascript'></script>
    <script src='js/errorbar.js' type='text/javascript'></script>
    <script src='js/d3-grid.js' type='text/javascript'></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 1000px;
      height: 500px;
    }  
    </style>
    
  </head>
  <body>
    
    <style>
.axis line, .axis path {
  fill: none;
  shape-rendering: crispEdges;
  stroke: lightgrey;
}
.axis text {
  fill: grey;
  font-family: "Source Sans Pro", sans-serif;
  font-size: 10px;
}
</style>

      <script>
       debugger;
      (function(){
        var opts = {
 "data": {
 "rank": [      1,      2,      3,      4,      5,      6,      7,      8,      9,     10,     11,     12,     13,     14,     15,     16,     17,     18,     19,     20,     21,     22,     23,     24,     25,     26,     27,     28,     29,     30,     31,     32,     33,     34,     35,     36,     37,     38,     39,     40 ],
"player": [ "Peyton Manning", "Aaron Rodgers", "Drew Brees", "Matthew Stafford", "Colin Kaepernick", "Michael Vick", "Matt Ryan", "Robert Griffin III", "Cam Newton", "Tony Romo", "Tom Brady", "Russell Wilson", "Eli Manning", "Andrew Luck", "Sam Bradford", "Andy Dalton", "Carson Palmer", "Philip Rivers", "Alex Smith", "Matt Schaub", "Jay Cutler", "Ryan Tannehill", "Terrelle Pryor", "Joe Flacco", "Josh Freeman", "Ben Roethlisberger", "E.J. Manuel", "Geno Smith", "Jake Locker", "Christian Ponder", "Jason Campbell", "Brandon Weeden", "Brian Hoyer", "Chad Henne", "Matt Flynn", "Kirk Cousins", "Mike Glennon", "Matt Cassel", "Matt Simms", "Jeff Tuel" ],
"best": [      1,      1,      1,      1,      1,      2,      2,      4,      2,      5,      3,      2,      5,      5,      8,      6,      7,      6,      9,      9,     11,     11,      8,     15,     15,     14,     14,     13,     16,     24,     25,     26,     26,     27,     33,     34,     35,     36,     37,     38 ],
"worst": [      4,     10,     11,     14,     11,     20,     15,     23,     18,     22,     22,     27,     21,     25,     27,     26,     26,     28,     29,     25,     30,     30,     31,     30,     31,     30,     31,     32,     31,     32,     54,     39,     32,     33,     63,     53,     58,     61,     62,     59 ],
"ave": [    1.4,    2.7,    3.4,    4.7,      5,      7,    8.1,    9.2,    9.6,   10.6,   11.1,   11.8,     13,   14.7,   16.5,   16.7,   17.2,   17.9,   18.3,   18.7,   20.7,   21.1,   21.4,   22.7,   25.2,   24.9,     26,   27.6,   27.3,   29.6,   32.3,   30.5,   30.2,     31,   43.7,   40.3,   41.3,   44.3,   49.5,   48.5 ],
"stddev": [    0.6,    1.4,    1.7,    2.1,      2,    3.2,    2.5,    3.4,      3,    2.5,    3.7,    4.3,    3.1,    3.9,      4,    4.1,    3.8,    3.8,    4.1,    3.2,    3.4,    3.8,    4.1,    2.9,    3.4,    2.7,      3,    2.7,      3,    1.6,    6.1,      3,    1.5,    1.5,   13.7,      9,    9.7,   11.8,   12.5,   10.5 ],
"category": [ "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb", "qb" ],
"ppr": [ "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N" ],
"pos": [ null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null ],
"matchup": [ null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null ] 
},
"height":    500,
"width":   1000,
"x": "player",
"y": "ave",
"color": "player",
"radius":      8,
"sort": {
 "var": "ave" 
},
"whiskers": function(d){return [d.ave - 1.96 * d.stddev, d.ave + 1.96 * d.stddev]},
"tooltipLabels": [ "player", "ave", "best", "worst" ] 
};
        //var margin = ,
        //  width =  - margin.left - margin.right,
        // height =  - margin.top - margin.bottom;

        var color = d3.scale.category20();

        var svg = d3.select("body").append("svg")
            .attr("width", opts.width)
            .attr("height", opts.height)

        //d3.json("fantasy.json", function (error, data) {

          if(!(opts.margin)) opts.margin = { top: 10, right: 50, bottom: 20, left: 50 }

          //data transform since rCharts does not use toJSONArray() by default
          var data = [];

          opts.data[d3.keys(opts.data)[0]].forEach(function(d,i){
            var tempobj = {};
            d3.keys(opts.data).forEach(function(key){
              tempobj[key] = opts.data[key][i];
            });
            data.push(tempobj);
          });

          //if no facet then just make blank object
          if(!(opts.facet)) opts.facet = {};
          //if facet not provided for x or y make Dummy variable
          opts.facet.x = opts.facet.x ? opts.facet.x : "Dummy"
          opts.facet.y = opts.facet.y ? opts.facet.y : "Dummy"    
          if(opts.facet.x === "Dummy" || opts.facet.y === "Dummy") {
            data.forEach(function(d){
              d.Dummy = 1;
            })
          }
          var rows = d3.set(data.map(function(d){return d[opts.facet.y]})).values();
          var nrow = rows.length;
          var cols = d3.set(data.map(function(d){return d[opts.facet.x]})).values()
          var ncol = cols.length;
  
          var tuples = d3.merge(
            rows.map(function(row,irow){
              return cols.map(function(col,icol){
                return {key:row + "~" + col, values: {"row":irow, "col":icol} }
              })
            })
          );
    
          var grid = d3.layout.grid()
            .rows( nrow )
            .cols( ncol )
            .size([ opts.width, opts.height-100])
            .bands();

          var svgGrid = d3.select("#" + opts.id).append("svg")
            .attr("width", opts.width)
            .attr("height", opts.height);
          
          grid(tuples);  //apply d3-grid layout

          tuples.forEach(function(cell,cellnum) {
            // Filter the data set for the x and y facets
            var filteredData = data.filter(function(d){
              return d[opts.facet.x] == cell.key.split('~')[1]
            });
            //split for now but could easily do all in one filter
            filteredData = filteredData.filter(function(d){
              return d[opts.facet.y] == cell.key.split('~')[0]
            });
    
            filteredData = d3.nest()
              .key(function(d){ return d[opts.facet.x] + "~" + opts.facet.y} ).sortKeys(d3.ascending)
              //.key(function(d){ return d[opts.group] } )
              .entries(filteredData);

            var errorbar = d3.svg.errorbar()
              .height(grid.nodeSize()[1]- opts.margin.top - opts.margin.bottom )
              .width(grid.nodeSize()[0] - opts.margin.right - opts.margin.left)
              .xVar(opts.x)
              .yVar(opts.y)
              .colorVar(opts.color)
              .color(color)
              .radius(opts.radius)
              .tooltipLabels(opts.tooltipLabels?opts.tooltipLabels:[]);

            if(opts.whiskers) {
              if (typeof opts.whiskers === "function") {
                errorbar.whiskers(opts.whiskers)
              } else {
                errorbar.whiskers(
                  function(d) {
                    return [d[opts.whiskers[0]], d[opts.whiskers[1]]]
                  }
                );
              }
            }; 

            if(opts.sort) {
              errorbar.sort(opts.sort);
            }

            var g = svg //.selectAll("g").data(filteredData);
              .append("g").data(filteredData) //g.enter().append("g")
                .attr("transform","translate(" + (+cell.x + opts.margin.right) + "," + (+cell.y+opts.margin.top) + ")")
                .call(errorbar);

          });
      })();
      </script>
    
  </body>
</html>
